<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Gráficos Lado a Lado</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    body {
      font-family: sans-serif;
    }

    .label {
      font-size: 12px;
      alignment-baseline: middle;
    }

    .dot {
      fill: lightblue;
      stroke: black;
      stroke-width: 1px;
    }

    .line {
      stroke: gray;
      stroke-width: 2px;
    }

    .question-label {
      font-weight: bold;
      font-size: 13px;
    }

    .container {
      display: flex;
      gap: 30px;
      padding: 20px;
    }
  </style>
</head>

<body>
  <div class="container">
    <svg id="grafico-precisao"></svg>
    <svg id="grafico-duracao"></svg>
  </div>

  <script>
    const datasets = [
      {
        selector: "#grafico-precisao",
        data: [{Pergunta:1,estrategia:"3d break",media:0.6667,IC95_inferior:0.2077,IC95_superior:0.9385},{Pergunta:1,estrategia:"default",media:1.0,IC95_inferior:0.4385,IC95_superior:1.0},{Pergunta:1,estrategia:"scale break perspective",media:1.0,IC95_inferior:0.4385,IC95_superior:1.0},{Pergunta:2,estrategia:"3d break",media:0.6667,IC95_inferior:0.2077,IC95_superior:0.9385},{Pergunta:2,estrategia:"default",media:1.0,IC95_inferior:0.4385,IC95_superior:1.0},{Pergunta:2,estrategia:"scale break perspective",media:0.6667,IC95_inferior:0.2077,IC95_superior:0.9385},{Pergunta:3,estrategia:"3d break",media:1.0,IC95_inferior:0.4385,IC95_superior:1.0},{Pergunta:3,estrategia:"default",media:1.0,IC95_inferior:0.4385,IC95_superior:1.0},{Pergunta:3,estrategia:"scale break perspective",media:1.0,IC95_inferior:0.4385,IC95_superior:1.0},{Pergunta:4,estrategia:"3d break",media:0.06,IC95_inferior:0.06,IC95_superior:0.06},{Pergunta:4,estrategia:"default",media:0.4133,IC95_inferior:0.41,IC95_superior:0.42},{Pergunta:4,estrategia:"scale break perspective",media:0.0967,IC95_inferior:0.09,IC95_superior:0.1},{Pergunta:5,estrategia:"3d break",media:2.1264,IC95_inferior:2.11,IC95_superior:2.15},{Pergunta:5,estrategia:"default",media:0.42,IC95_inferior:0.42,IC95_superior:0.42},{Pergunta:5,estrategia:"scale break perspective",media:0.0565,IC95_inferior:0.03,IC95_superior:0.08},{Pergunta:6,estrategia:"3d break",media:0.0667,IC95_inferior:0.05,IC95_superior:0.08},{Pergunta:6,estrategia:"default",media:0.2228,IC95_inferior:0.12,IC95_superior:0.37},{Pergunta:6,estrategia:"scale break perspective",media:0.4022,IC95_inferior:0.06,IC95_superior:0.93},{Pergunta:7,estrategia:"3d break",media:0.7622,IC95_inferior:0.0,IC95_superior:2.32},{Pergunta:7,estrategia:"default",media:0.0595,IC95_inferior:0.0,IC95_superior:0.18},{Pergunta:7,estrategia:"scale break perspective",media:0.0167,IC95_inferior:0.0,IC95_superior:0.05},{Pergunta:8,estrategia:"3d break",media:1.0,IC95_inferior:0.4385,IC95_superior:1.0},{Pergunta:8,estrategia:"default",media:0.6667,IC95_inferior:0.2077,IC95_superior:0.9385},{Pergunta:8,estrategia:"scale break perspective",media:0.6667,IC95_inferior:0.2077,IC95_superior:0.9385}]

      },
      {
        selector: "#grafico-duracao",
        data: [{ Pergunta: 1, estrategia: "3d break", media: 11.0, IC95_inferior: 11.0, IC95_superior: 11.0 }, { Pergunta: 1, estrategia: "default", media: 9.0, IC95_inferior: 9.0, IC95_superior: 9.0 }, { Pergunta: 1, estrategia: "scale break perspective", media: 9.0, IC95_inferior: 9.0, IC95_superior: 9.0 }, { Pergunta: 2, estrategia: "3d break", media: 9.0, IC95_inferior: 9.0, IC95_superior: 9.0 }, { Pergunta: 2, estrategia: "default", media: 9.0, IC95_inferior: 9.0, IC95_superior: 9.0 }, { Pergunta: 2, estrategia: "scale break perspective", media: 6.0, IC95_inferior: 6.0, IC95_superior: 6.0 }, { Pergunta: 3, estrategia: "3d break", media: 24.0, IC95_inferior: 24.0, IC95_superior: 24.0 }, { Pergunta: 3, estrategia: "default", media: 20.0, IC95_inferior: 20.0, IC95_superior: 20.0 }, { Pergunta: 3, estrategia: "scale break perspective", media: 7.0, IC95_inferior: 7.0, IC95_superior: 7.0 }, { Pergunta: 4, estrategia: "3d break", media: 7.0, IC95_inferior: 7.0, IC95_superior: 7.0 }, { Pergunta: 4, estrategia: "default", media: 8.0, IC95_inferior: 8.0, IC95_superior: 8.0 }, { Pergunta: 4, estrategia: "scale break perspective", media: 8.0, IC95_inferior: 8.0, IC95_superior: 8.0 }, { Pergunta: 5, estrategia: "3d break", media: 16.0, IC95_inferior: 16.0, IC95_superior: 16.0 }, { Pergunta: 5, estrategia: "default", media: 12.0, IC95_inferior: 12.0, IC95_superior: 12.0 }, { Pergunta: 5, estrategia: "scale break perspective", media: 24.0, IC95_inferior: 24.0, IC95_superior: 24.0 }, { Pergunta: 6, estrategia: "3d break", media: 10.0, IC95_inferior: 10.0, IC95_superior: 10.0 }, { Pergunta: 6, estrategia: "default", media: 11.0, IC95_inferior: 11.0, IC95_superior: 11.0 }, { Pergunta: 6, estrategia: "scale break perspective", media: 7.0, IC95_inferior: 7.0, IC95_superior: 7.0 }, { Pergunta: 7, estrategia: "3d break", media: 26.0, IC95_inferior: 26.0, IC95_superior: 26.0 }, { Pergunta: 7, estrategia: "default", media: 19.0, IC95_inferior: 19.0, IC95_superior: 19.0 }, { Pergunta: 7, estrategia: "scale break perspective", media: 30.0, IC95_inferior: 30.0, IC95_superior: 30.0 }, { Pergunta: 8, estrategia: "3d break", media: 16.0, IC95_inferior: 16.0, IC95_superior: 16.0 }, { Pergunta: 8, estrategia: "default", media: 9.0, IC95_inferior: 9.0, IC95_superior: 9.0 }, { Pergunta: 8, estrategia: "scale break perspective", media: 10.0, IC95_inferior: 10.0, IC95_superior: 10.0 }]
      }
    ];

    // datasets.forEach(({ selector, data }) => {
    //   renderGrafico2(selector, data);
    // });

    datasets.forEach(({ selector, data }) => {
      if (selector === "#grafico-precisao") {
        renderGrafico1(selector, data);  // Para grafico-precisao chama renderGrafico1
      } else if (selector === "#grafico-duracao") {
        renderGrafico2(selector, data);  // Para grafico-duracao chama renderGrafico2
      }
    });

    function renderGrafico1(selector, rawData) {
      const controlewidth = 400;
      const margin = { top: 30, right: 40, bottom: 20, left: controlewidth };
      const width = 1000 - margin.left - margin.right;
      const rowHeight = 30;
      const height = rowHeight * rawData.length + 100;

      const svg = d3.select(selector)
        .attr("width", width + margin.left + margin.right)
        .attr("height", height);

      const g = svg.append("g").attr("transform", `translate(${margin.left},${margin.top})`);

      g.append("line")
        .attr("x1", -controlewidth)
        .attr("x2", 0)
        .attr("y1", -5)
        .attr("y2", -5)
        .attr("stroke", "black")
        .attr("stroke-width", 3);

      g.append("text").attr("x", -controlewidth).attr("y", -15).text("Task").attr("font-weight", "bold");
      g.append("text").attr("x", -controlewidth * 0.85).attr("y", -15).text("Strategy").attr("font-weight", "bold");
      g.append("text").attr("x", -controlewidth * 0.35).attr("y", -15).text("Estimate (95% CI)").attr("font-weight", "bold");

      const x = d3.scaleLinear()
        .domain([
          d3.min(rawData, d => d.IC95_inferior) - 0.1,
          d3.max(rawData, d => d.IC95_superior) + 0.1
        ])
        .range([0, width]);

      // Calculando o meio do eixo x
      const xCenter = (d3.min(rawData, d => d.IC95_inferior) + d3.max(rawData, d => d.IC95_superior)) / 2;

      g.append("text")
        .attr("x", x(xCenter))  // Posição no meio do eixo X
        .attr("y", 760)  // Posição no eixo y
        .text("Erro")
        .attr("font-weight", "bold")
        .attr("text-anchor", "middle");  // Para garantir que o texto seja centralizado

      const y = d3.scaleBand()
        .domain(rawData.map((_, i) => i))
        .range([0, rowHeight * rawData.length])
        .padding(0.2);

      g.append("g")
        .attr("transform", `translate(0,${rowHeight * rawData.length})`)
        .call(d3.axisBottom(x));

      g.selectAll(".line")
        .data(rawData)
        .enter()
        .append("line")
        .attr("class", "line")
        .attr("x1", d => x(d.IC95_inferior))
        .attr("x2", d => x(d.IC95_superior))
        .attr("y1", (d, i) => y(i) + y.bandwidth() / 2)
        .attr("y2", (d, i) => y(i) + y.bandwidth() / 2);

      g.selectAll(".dot")
        .data(rawData)
        .enter()
        .append("circle")
        .attr("class", "dot")
        .attr("cx", d => x(d.media))
        .attr("cy", (d, i) => y(i) + y.bandwidth() / 2)
        .attr("r", 5);

      g.selectAll(".estrategia-label")
        .data(rawData)
        .enter()
        .append("text")
        .attr("x", -controlewidth * 0.85)
        .attr("y", (d, i) => y(i) + y.bandwidth() / 2)
        .text(d => d.estrategia);

      g.selectAll(".valor-label")
        .data(rawData)
        .enter()
        .append("text")
        .attr("x", -controlewidth * 0.35)
        .attr("y", (d, i) => y(i) + y.bandwidth() / 2)
        .text(d => `${d.media.toFixed(3)} (${d.IC95_inferior.toFixed(2)} to ${d.IC95_superior.toFixed(2)})`);

      const perguntasUnicas = [...new Set(rawData.map(d => d.Pergunta))];
      perguntasUnicas.forEach((pergunta, idx) => {
        const indices = rawData.map((d, i) => ({ i, pergunta: d.Pergunta }))
          .filter(d => d.pergunta === pergunta)
          .map(d => d.i);

        const yMean = d3.mean(indices, i => y(i) + y.bandwidth() / 2);

        g.append("text")
          .attr("class", "question-label")
          .attr("x", -(controlewidth * 0.967))
          .attr("y", yMean)
          .attr("text-anchor", "start")
          .text(`${pergunta}`);

        if (idx < perguntasUnicas.length - 1) {
          const lastIndex = indices[indices.length - 1];
          g.append("line")
            .attr("x1", -controlewidth)
            .attr("y1", y(lastIndex) + y.bandwidth())
            .attr("y2", y(lastIndex) + y.bandwidth())
            .attr("stroke", "gray")
            .attr("stroke-width", 1);
        }
      });
    }

    function renderGrafico2(selector, rawData) {
      const controlewidth = 169;
      const margin = { top: 30, right: 40, bottom: 20, left: controlewidth };
      const width = 1000 - margin.left - margin.right;
      const rowHeight = 30;
      const height = rowHeight * rawData.length + 100;

      const svg = d3.select(selector)
        .attr("width", width + margin.left + margin.right)
        .attr("height", height);

      const g = svg.append("g").attr("transform", `translate(${margin.left},${margin.top})`);

      g.append("line")
        .attr("x1", -controlewidth)
        .attr("x2", 0)
        .attr("y1", -5)
        .attr("y2", -5)
        .attr("stroke", "black")
        .attr("stroke-width", 3);

      g.append("text").attr("x", -controlewidth).attr("y", -15).text("Estimate (95% CI)").attr("font-weight", "bold");


      const x = d3.scaleLinear()
        .domain([
          d3.min(rawData, d => d.IC95_inferior) - 1.0,
          d3.max(rawData, d => d.IC95_superior) + 0.1
        ])
        .range([0, width]);

      // Calculando o meio do eixo x
      const xCenter = (d3.min(rawData, d => d.IC95_inferior) + d3.max(rawData, d => d.IC95_superior)) / 2;

      g.append("text")
        .attr("x", x(xCenter))  // Posição no meio do eixo X
        .attr("y", 760)  // Posição no eixo y
        .text("Time")
        .attr("font-weight", "bold")
        .attr("text-anchor", "middle");  // Para garantir que o texto seja centralizado
      const y = d3.scaleBand()
        .domain(rawData.map((_, i) => i))
        .range([0, rowHeight * rawData.length])
        .padding(0.2);

      g.append("g")
        .attr("transform", `translate(0,${rowHeight * rawData.length})`)
        .call(d3.axisBottom(x));

      g.selectAll(".line")
        .data(rawData)
        .enter()
        .append("line")
        .attr("class", "line")
        .attr("x1", d => x(d.IC95_inferior))
        .attr("x2", d => x(d.IC95_superior))
        .attr("y1", (d, i) => y(i) + y.bandwidth() / 2)
        .attr("y2", (d, i) => y(i) + y.bandwidth() / 2);

      g.selectAll(".dot")
        .data(rawData)
        .enter()
        .append("circle")
        .attr("class", "dot")
        .attr("cx", d => x(d.media))
        .attr("cy", (d, i) => y(i) + y.bandwidth() / 2)
        .attr("r", 5);

      g.selectAll(".valor-label")
        .data(rawData)
        .enter()
        .append("text")
        .attr("x", -controlewidth)
        .attr("y", (d, i) => y(i) + y.bandwidth() / 2)
        .text(d => `${d.media.toFixed(3)} (${d.IC95_inferior.toFixed(2)} to ${d.IC95_superior.toFixed(2)})`);

      const perguntasUnicas = [...new Set(rawData.map(d => d.Pergunta))];
      perguntasUnicas.forEach((pergunta, idx) => {
        const indices = rawData.map((d, i) => ({ i, pergunta: d.Pergunta }))
          .filter(d => d.pergunta === pergunta)
          .map(d => d.i);

        const yMean = d3.mean(indices, i => y(i) + y.bandwidth() / 2);

        if (idx < perguntasUnicas.length - 1) {
          const lastIndex = indices[indices.length - 1];
          g.append("line")
            .attr("x1", -controlewidth)
            .attr("y1", y(lastIndex) + y.bandwidth())
            .attr("y2", y(lastIndex) + y.bandwidth())
            .attr("stroke", "gray")
            .attr("stroke-width", 1);
        }
      });
    }
  </script>
</body>

</html>